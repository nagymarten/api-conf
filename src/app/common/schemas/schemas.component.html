<div *ngIf="apiSchemas.length > 0">
  <form [formGroup]="schemaDetailsForm" (ngSubmit)="onUpdateSchema()">
    <div class="schema-details">
      <h1>
        <input
          *ngIf="schemaDetailsForm.get('isEditingTitle')?.value"
          formControlName="title"
          (blur)="stopEditingTitle()"
          placeholder="Schema Title"
          class="title-editor"
        />

        <span
          *ngIf="!schemaDetailsForm.get('isEditingTitle')?.value"
          (click)="startEditingTitle()"
          class="title-text"
        >
          {{
            schemaDetailsForm.get("title")?.value ||
              selectedSchemaName ||
              "Click to add a title"
          }}
        </span>
      </h1>

      <div class="description-section">
        <p
          *ngIf="!schemaDetailsForm.get('isEditingDescription')?.value"
          (click)="startEditingDescription()"
          class="description-text"
        >
          {{
            schemaDetailsForm.get("description")?.value ||
              "Click to add a description"
          }}
        </p>

        <textarea
          *ngIf="schemaDetailsForm.get('isEditingDescription')?.value"
          formControlName="description"
          (blur)="stopEditingDescription()"
          placeholder="Description"
          class="description-editor"
        ></textarea>
      </div>

      <div class="tabs">
        <ul>
          <li
            [ngClass]="{ active: activeTab === 'schema' }"
            (click)="setActiveTab('schema')"
          >
            <button type="button">Schema</button>
          </li>
          <li
            [ngClass]="{ active: activeTab === 'examples' }"
            (click)="setActiveTab('examples')"
          >
            <button type="button">Examples</button>
          </li>
          <li
            [ngClass]="{ active: activeTab === 'extensions' }"
            (click)="setActiveTab('extensions')"
          >
            <button type="button">Extensions</button>
          </li>
        </ul>
      </div>

      <div *ngIf="activeTab === 'schema'" class="api-details">
        <div class="properties-section">
          <div *ngIf="selectedSchema">
            <p-treeTable
              [value]="jsonTree"
              [columns]="cols"
              [scrollable]="true"
              [tableStyle]="{ 'min-width': '50rem' }"
            >
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th *ngFor="let col of columns">
                    {{ col.header }}
                  </th>
                </tr>
              </ng-template>

              <ng-template
                pTemplate="body"
                let-rowNode
                let-rowData="rowData"
                let-columns="columns"
              >
                <tr [ttRow]="rowNode">
                  <td
                    *ngFor="let col of columns; let i = index"
                    [ttEditableColumn]="
                      col.field === 'name' && rowNode !== jsonTree[0]
                    "
                    [ttEditableColumnDisabled]="rowNode === jsonTree[0]"
                    [ngClass]="{ 'p-toggler-column': i === 0 }"
                  >
                    <app-add-scheme-button
                      [rowData]="rowData"
                      [col]="col"
                      [jsonTree]="jsonTree"
                      (addScheme)="handleAddScheme($event)"
                    ></app-add-scheme-button>
                    <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0" />

                    <ng-container
                      *ngIf="col.field === 'name' && rowNode !== jsonTree[0]"
                    >
                      <p-treeTableCellEditor>
                        <ng-template pTemplate="input">
                          <input
                            pInputText
                            type="text"
                            [(ngModel)]="rowData[col.field]"
                            [ngModelOptions]="{ standalone: true }"
                          />
                        </ng-template>

                        <ng-template pTemplate="output">
                          {{ rowData[col.field] }}
                        </ng-template>
                      </p-treeTableCellEditor>
                    </ng-container>

                    <ng-container
                      *ngIf="rowNode === jsonTree[0] || col.field !== 'name'"
                    >
                      <ng-container
                        *ngIf="col.field === 'name' && rowNode === jsonTree[0]"
                      >
                        {{ rowData[col.field] }}
                      </ng-container>

                      <ng-container *ngIf="col.field !== 'name'">
                        <ng-container *ngIf="isSpecialType(rowData[col.field])">
                          <p-button
                            label="{{ rowData[col.field] }}"
                            [outlined]="true"
                            (click)="toggleChildOverlay($event)"
                            class="no-border-button"
                          ></p-button>
                          <app-scheme-type-overlay-panel
                            #overlayPanel
                            [rowData]="rowData"
                            [col]="col"
                            [apiSchemas]="apiSchemas"
                          ></app-scheme-type-overlay-panel>
                        </ng-container>
                        <ng-container
                          *ngIf="!isSpecialType(rowData[col.field])"
                        >
                          {{ rowData[col.field] }}
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </td>
                </tr>
              </ng-template>
            </p-treeTable>
          </div>
          <div *ngIf="selectedSchema.enum">
            <h4>Enum Reference:</h4>
            <a href="#">{{ selectedSchemaName }}</a>
          </div>

          <div
            *ngIf="
              !selectedSchema.properties &&
              !selectedSchema.enum &&
              !selectedSchema.allOf
            "
          >
            <p>No properties available for this schema.</p>
          </div>
        </div>
      </div>

      <div *ngIf="activeTab === 'examples'" class="api-details">
        <h3>Schema Examples</h3>
        <div *ngIf="selectedSchema?.examples?.length; else noExamples">
          <div class="card">
            <p-tabMenu
              [model]="responseExamples"
              [(activeItem)]="activeItem"
            ></p-tabMenu>
          </div>

          <div class="card flex justify-content-center">
            <textarea
              rows="5"
              cols="30"
              pInputTextarea
              [autoResize]="true"
              formControlName="examples"
            ></textarea>
          </div>
        </div>

        <ng-template #noExamples>
          <p>No examples available for this schema.</p>
        </ng-template>
      </div>
      <div *ngIf="activeTab === 'extensions'" class="api-details">
        extensions
      </div>

      <button type="submit" [disabled]="!schemaDetailsForm.valid">
        Update Schema
      </button>
    </div>
  </form>
</div>
