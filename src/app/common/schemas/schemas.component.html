<div *ngIf="apiSchemas.length > 0">
  <form [formGroup]="schemaDetailsForm" (ngSubmit)="onUpdateSchema()">
    <div class="schema-details">
      <h1>
        <input *ngIf="schemaDetailsForm.get('isEditingTitle')?.value" formControlName="title" (blur)="stopEditingTitle()"
          placeholder="Schema Title" class="title-editor" />
        <span *ngIf="!schemaDetailsForm.get('isEditingTitle')?.value" (click)="startEditingTitle()" class="title-text">
          {{
          schemaDetailsForm.get("title")?.value ||
          "Click to add a title"
          }}
        </span>
      </h1>

      <div class="description-section">
        <p
          *ngIf="!schemaDetailsForm.get('isEditingDescription')?.value"
          (click)="startEditingDescription()"
          class="description-text"
        >
          {{
            schemaDetailsForm.get("description")?.value ||
              "Click to add a description"
          }}
        </p>

        <textarea
          *ngIf="schemaDetailsForm.get('isEditingDescription')?.value"
          formControlName="description"
          (blur)="stopEditingDescription()"
          placeholder="Description"
          class="description-editor"
        ></textarea>
      </div>

      <div class="tabs">
        <ul>
          <li
            [ngClass]="{ active: activeTab === 'schema' }"
            (click)="setActiveTab('schema')"
          >
            <button type="button">Schema</button>
          </li>
          <li
            [ngClass]="{ active: activeTab === 'examples' }"
            (click)="setActiveTab('examples')"
          >
            <button type="button">Examples</button>
          </li>
          <li
            [ngClass]="{ active: activeTab === 'extensions' }"
            (click)="setActiveTab('extensions')"
          >
            <button type="button">Extensions</button>
          </li>
        </ul>
      </div>

      <div *ngIf="activeTab === 'schema'" class="api-details">
        <div class="properties-section">
          <h3>Schema type</h3>

          <div *ngIf="selectedSchema.properties">
            <span class="property-count">
              Object({{ objectKeys(selectedSchema.properties).length }})
            </span>
            <div *ngIf="selectedSchema.allOf">
              <span class="property-count">
                allOf({{ selectedSchema.allOf.length }})
              </span>
              <div *ngFor="let item of additionalItems">
                <h4>{{ item.type }}:</h4>
                <ul>
                  <li *ngFor="let value of item.values">{{ value }}</li>
                </ul>
              </div>
            </div>
            <button class="" (click)="onAddProperty()" type="button">+</button>

            <p-treeTable [value]="jsonTree" [columns]="cols" [scrollable]="true" [tableStyle]="{ 'min-width': '50rem' }">
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th *ngFor="let col of columns">
                    {{ col.header }}
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
                <tr [ttRow]="rowNode">
                  <td *ngFor="let col of columns; let i = index" ttEditableColumn [ttEditableColumnDisabled]="i == 0"
                    [ngClass]="{ 'p-toggler-column': i === 0 }">
                    <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0" />
                    <p-treeTableCellEditor>
                      <ng-template pTemplate="input">
                        <input pInputText type="text" [(ngModel)]="rowData[col.field]" />
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{ rowData[col.field] }}
                      </ng-template>
                    </p-treeTableCellEditor>
                  </td>
                </tr>
              </ng-template>
            </p-treeTable>
          </div>

          <!-- If schema has enum at the top level -->
          <div *ngIf="selectedSchema.enum">
            <h4>Enum Reference:</h4>
            <a href="#">{{ selectedSchemaName }}</a>
          </div>

          <!-- Fallback for any other case -->
          <div
            *ngIf="
              !selectedSchema.properties &&
              !selectedSchema.enum &&
              !selectedSchema.allOf
            "
          >
            <p>No properties available for this schema.</p>
          </div>
        </div>
      </div>

      <div *ngIf="activeTab === 'examples'" class="api-details">examples</div>
      <div *ngIf="activeTab === 'extensions'" class="api-details">
        extensions
      </div>

      <button type="submit" [disabled]="!schemaDetailsForm.valid">
        Update Schema
      </button>
    </div>
  </form>
</div>